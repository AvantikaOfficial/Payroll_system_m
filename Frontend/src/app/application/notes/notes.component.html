<app-nav-bar></app-nav-bar>

<div class="main-wrapper">
  <div class="page-wrapper">
    <div class="content pb-0">

      <!-- Page Header -->
      <div class="d-flex align-items-sm-center flex-sm-row flex-column gap-2 pb-3">
        <div class="flex-grow-1">
          <h5 class="fw-bold mb-0">Notes</h5>
        </div>
      </div>

      <div class="row">
        <!-- Sidebar -->
        <div class="col-xl-3 col-md-12 theiaStickySidebar">
          <div class="card">
            <div class="card-body">
              <h6 class="mb-3">Notes List</h6>
              <ul class="nav flex-column mb-4">
                <li class="nav-item mb-2">
                  <a class="nav-link active d-flex align-items-center" href="javascript:void(0);" (click)="showAll()">
                    <i class="ti ti-mail me-2"></i> All Notes
                  </a>
                </li>
                <li class="nav-item mb-2">
                  <a class="nav-link d-flex align-items-center" href="javascript:void(0);" (click)="showImportant()">
                    <i class="ti ti-star me-2"></i> Important
                  </a>
                </li>
                <li class="nav-item mb-2">
                  <a class="nav-link d-flex align-items-center" href="javascript:void(0);" (click)="showTrash()">
                    <i class="ti ti-trash me-2"></i> Trash
                  </a>
                </li>
              </ul>

              <h6 class="mb-3">Tags</h6>
              <ul class="list-unstyled mb-4">
                <li class="mb-2"><span class="badge bg-primary me-2">&nbsp;</span>Pending</li>
                <li class="mb-2"><span class="badge bg-danger me-2">&nbsp;</span>Onhold</li>
                <li class="mb-2"><span class="badge bg-success me-2">&nbsp;</span>Completed</li>
              </ul>
            </div>
          </div>
        </div>

        <!-- Notes Section -->
        <div class="col-xl-9">
          <div class="card mb-3">
            <div class="card-body d-flex align-items-center justify-content-between flex-wrap gap-2">
              <div>
                <!-- âœ… FIXED LINE -->
                <select class="form-select" (change)="onBulkActionFromEvent($event)">
  <option value="">Bulk Actions</option>
  <option value="delete">Delete Marked</option>
  <option value="unmark">Unmark All</option>
  <option value="mark">Mark All</option>
</select>

              </div>
              <div class="d-flex align-items-center flex-wrap gap-2">
                <a href="javascript:void(0);" class="btn btn-primary btn-md d-flex align-items-center" (click)="openModal()">
                  <i class="ti ti-circle-plus me-1"></i>Add Notes
                </a>
              </div>
            </div>
          </div>

          <!-- Notes List -->
          <div class="row">
            <div *ngFor="let note of filteredNotes" class="col-md-4 d-flex mb-3">
              <div class="card flex-fill">
                <div class="card-body">
                  <div class="d-flex align-items-center justify-content-between">
                    <div>
                      <input type="checkbox" [(ngModel)]="note.selected">
                    </div>
                    <span class="badge badge-outline-warning d-inline-flex align-items-center">
                      <i class="ti ti-circle-filled fs-7 me-1"></i>{{ note.priority }}
                    </span>
                    <div>
                      <a href="javascript:void(0);" data-bs-toggle="dropdown">
                        <i class="ti ti-dots-vertical"></i>
                      </a>
                      <div class="dropdown-menu notes-menu dropdown-menu-end">
                        <a class="dropdown-item" (click)="toggleImportant(note)">
  <i class="ti ti-star me-1"></i>
  {{ note.isImportant ? 'Unmark Important' : 'Mark Important' }}
</a>
                        <a href="javascript:void(0);" class="dropdown-item" (click)="deleteNote(note.id)">
                          <i class="ti ti-trash me-1"></i> Delete
                        </a>
                      </div>
                    </div>
                  </div>

                  <div class="my-3">
                    <h6 class="fs-16 text-truncate mb-1">{{ note.title }}</h6>
                    <p class="mb-3 d-flex align-items-center text-dark">
                      <i class="ti ti-calendar me-1"></i>{{ note.due_date }}
                    </p>
                    <p class="text-truncate">{{ note.description }}</p>
                  </div>

                  <div class="d-flex align-items-center justify-content-between border-top pt-3">
                    <div class="d-flex align-items-center">
                      <span class="text-primary d-flex align-items-center">
                        <i class="ti ti-square-filled square-rotate fs-10 me-1"></i>{{ note.tag }}
                      </span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

        </div>
      </div>
    </div>
  </div>
</div>

<!-- Add Note Modal -->
<div class="modal fade" [ngClass]="{'show d-block': showModal}" style="background: rgba(0,0,0,0.5);" *ngIf="showModal">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Add New Note</h5>
        <button type="button" class="btn-close" (click)="closeModal()"></button>
      </div>
      <div class="modal-body">
        <form (ngSubmit)="addNote()">
          <div class="mb-3">
            <label class="form-label">Title</label>
            <input type="text" class="form-control" [(ngModel)]="newNote.title" name="title" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Assignee</label>
            <input type="text" class="form-control" [(ngModel)]="newNote.assignee" name="assignee">
          </div>
          <div class="mb-3">
            <label class="form-label">Tag</label>
            <input type="text" class="form-control" [(ngModel)]="newNote.tag" name="tag">
          </div>
          <div class="row">
            <div class="col-md-6 mb-3">
              <label class="form-label">Priority</label>
              <select class="form-select" [(ngModel)]="newNote.priority" name="priority">
                <option>Low</option>
                <option>Medium</option>
                <option>High</option>
              </select>
            </div>
            <div class="col-md-6 mb-3">
              <label class="form-label">Due Date</label>
              <input type="date" class="form-control" [(ngModel)]="newNote.due_date" name="due_date">
            </div>
          </div>
          <div class="mb-3">
            <label class="form-label">Status</label>
            <select class="form-select" [(ngModel)]="newNote.status" name="status">
              <option>Pending</option>
              <option>Completed</option>
            </select>
          </div>
          <div class="mb-3">
            <label class="form-label">Description</label>
            <textarea class="form-control" [(ngModel)]="newNote.description" name="description"></textarea>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" (click)="closeModal()">Cancel</button>
            <button type="submit" class="btn btn-primary">Add Note</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>